<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title id="page-title-transcribe">Transcription Tool with Ads and Guide Overlay</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&family=Merriweather:wght@300;400&display=swap"
    rel="stylesheet"
  />
  <style>
    /* Base Styles */
    html,
    body {
      margin: 0;
      padding: 0;
    }
    body {
      font-family: 'Roboto', sans-serif;
      background-color: #f8f8f8;
      color: #333;
    }
    /* Grid Layout: Single Row, 3 Columns */
    .grid-container {
      display: grid;
      grid-template-columns: 300px 1fr 300px; /* Left sidebar, main content, right sidebar */
      grid-template-rows: 100%;               /* Only one row */
      height: 100vh;                          /* Fill the viewport height */
    }
    /* Left Sidebar - Updated: No padding and no gap so ads fill the space */
    .sidebar {
      grid-column: 1 / 2;
      grid-row: 1 / 2;
      background-color: #e0e0e0;
      padding: 0;
      display: flex;
      flex-direction: column;
      gap: 0;
      position: relative;
    }
    /* Right Sidebar (Ad Area) */
    .ad-sidebar {
      grid-column: 3 / 4;
      grid-row: 1 / 2;
      background-color: #e0e0e0;
      /* Remove top padding so the ad is pushed up */
      padding: 0 20px 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    /* Main Content */
    .main-content {
      grid-column: 2 / 3;
      grid-row: 1 / 2;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
      /* Remove horizontal padding so top bar is flush with sidebars */
      padding: 0;
    }
    /* Top Bar within main content */
    .top-bar {
      background-color: #e0e0e0; /* Matches sidebars */
      padding: 20px;            /* Increased padding for a thicker bar */
      margin-bottom: 20px;      /* Space below the top bar */
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .top-bar button {
      font-size: 18px;
      padding: 10px 20px;
    }
    /* Language Container in Top Bar (right side) */
    #lang-container-transcribe {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    #lang-icon-transcribe {
      width: 36px;
      height: 36px;
    }
    #lang-select-transcribe {
      padding: 5px;
      font-size: 18px;
    }
    /* Recording Area */
    .recording-area {
      border-bottom: 1px solid #ddd;
      padding-bottom: 20px;
      padding-left: 20px;
      padding-right: 20px;
    }
    .recording-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    .timer {
      font-size: 18px;
      margin-bottom: 10px;
      color: #333;
    }
    /* Cost Overview Hyperlink */
    #openaiUsageLink {
      font-size: inherit;
      font-family: inherit;
      text-decoration: underline;
      color: blue;
      margin: 0;
    }
    #openaiUsageLink:hover {
      color: darkblue;
    }
    /* Auto-resizing Textareas */
    #transcription,
    #generatedNote,
    #customPrompt {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 10px;
      font-size: 16px;
      box-sizing: border-box;
      margin-bottom: 20px;
      font-family: 'Roboto', sans-serif;
      resize: none;
    }
    #transcription {
      resize: vertical;
    }
    #transcription,
    #generatedNote {
      min-height: 150px;
    }
    #customPrompt {
      min-height: 200px;
    }
    /* Button Styles */
    button {
      background-color: #5a9;
      color: #fff;
      border: none;
      border-radius: 10px;
      padding: 12px 20px;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.3s, transform 0.1s;
      margin: 10px;
    }
    button:hover {
      background-color: #489;
    }
    button:active {
      transform: scale(0.98);
    }
    button:disabled {
      background-color: #ccc;
      color: #666;
      cursor: not-allowed;
      opacity: 0.6;
      transition: none;
      transform: none;
    }
    /* Bottom Half: Two Columns */
    .bottom-half {
      display: flex;
      gap: 20px;
      flex: 1;
      padding: 0 20px; /* Maintain side padding for bottom half content */
    }
    .column {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    /* Ad Containers for Right Sidebar */
    #right-ad-unit-1 {
      width: 300px;
      min-height: 250px;
      background: transparent;
      margin-bottom: 0;
    }
    #right-ad-unit-2 {
      width: 300px;
      min-height: 250px;
      background: transparent;
      margin-top: 10px;
    }
    /* Ad Containers for Left Sidebar */
    #left-ad-unit-1 {
      width: 100%;
      min-height: 150px;
      background: transparent;
      margin-bottom: 10px;
    }
    #left-ad-unit-2 {
      width: 100%;
      min-height: 150px;
      background: transparent;
    }
    /* Hide leftover forced-color-adjust elements */
    div[style*="forced-color-adjust: initial"] {
      display: none !important;
      height: 0 !important;
      margin: 0 !important;
      padding: 0 !important;
    }
    /* Guide Overlay Styles */
    #guideView {
      display: none;
      position: fixed;
      top: 10%;
      left: 10%;
      width: 80%;
      height: 80%;
      background: white;
      border: 2px solid #ccc;
      padding: 20px;
      overflow-y: auto;
      z-index: 2000;
    }
    #guideView.active {
      display: block;
    }
  </style>
</head>
<body>
  <div class="grid-container">
    <!-- Left Sidebar (reserved for ads) with two new ad units -->
    <aside class="sidebar">
      <div id="left-ad-unit-1"></div>
      <div id="left-ad-unit-2"></div>
    </aside>
    <!-- Main Content (center column) -->
    <main class="main-content">
      <!-- Top Bar inside Main Content -->
      <div class="top-bar">
        <button id="btnGuide">Guide</button>
        <div id="lang-container-transcribe">
          <img src="language-icon.png" alt="Language Icon" id="lang-icon-transcribe" />
          <select id="lang-select-transcribe">
            <option value="en">English</option>
            <option value="no">Norsk</option>
            <option value="sv">Svenska</option>
            <option value="de">Deutsch</option>
            <option value="fr">Fran√ßais</option>
            <option value="it">Italiano</option>
          </select>
        </div>
      </div>
      <!-- Recording Area -->
      <div class="recording-area">
        <div class="recording-header">
          <h3 id="recordingAreaTitle">Recording Area</h3>
          <a id="openaiUsageLink" href="https://platform.openai.com/usage" target="_blank" rel="noopener noreferrer">Cost usage overview</a>
        </div>
        <div id="recordTimer" class="timer">Recording Timer: 0 sec</div>
        <div id="transcribeTimer" class="timer">Completion Timer: 0 sec</div>
        <textarea id="transcription" placeholder="Transcription result will appear here..."></textarea>
        <div>
          <button id="startButton">Start Recording</button>
          <button id="stopButton" disabled>Stop/Complete</button>
          <button id="pauseResumeButton" disabled>Pause Recording</button>
        </div>
        <div id="statusMessage">Welcome! Click "Start Recording" to begin.</div>
      </div>
      <!-- Note Generation & Custom Prompt -->
      <div class="bottom-half">
        <div class="column">
          <h3 id="noteGenerationTitle">Note Generation</h3>
          <button id="generateNoteButton">Generate Note</button>
          <div id="noteTimer" class="timer">Note Generation Timer: 0 sec</div>
          <textarea id="generatedNote" readonly placeholder="Generated note will appear here..."></textarea>
        </div>
        <div class="column">
          <h3 id="customPromptTitle">Custom Prompt</h3>
          <label for="promptSlot" id="promptSlotLabel">Prompt Slot:</label>
          <select id="promptSlot">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
            <option value="10">10</option>
          </select>
          <textarea id="customPrompt" placeholder="Enter custom prompt here" rows="1"></textarea>
        </div>
      </div>
    </main>
    <!-- Right Sidebar (Ad Area) -->
    <aside class="ad-sidebar">
      <div id="right-ad-unit-1"></div>
      <div id="right-ad-unit-2"></div>
    </aside>
  </div>

  <!-- Guide Overlay (outside the grid container) -->
  <div id="guideView">
    <h3 id="guideHeading">Guide & Instructions</h3>
    <p id="guideText"></p>
  </div>

  <!-- Inline script to toggle the guide overlay -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const btnGuide = document.getElementById("btnGuide");
      const guideView = document.getElementById("guideView");
      if (btnGuide && guideView) {
        btnGuide.addEventListener("click", function () {
          guideView.classList.toggle("active");
        });
      }
    });
  </script>

  <!-- Dynamic Ad Injection Scripts -->
  <script>
    function loadAdSenseAds(callback) {
      const consent = document.cookie.indexOf("user_consent=accepted") !== -1;
      const npaParam = consent ? "" : "&npa=1";
      const adScript = document.createElement("script");
      adScript.async = true;
      adScript.src = "https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3747901131960450" + npaParam;
      adScript.crossOrigin = "anonymous";
      adScript.onload = callback;
      document.head.appendChild(adScript);
    }

    function insertAdSenseAd(containerId, adSlot) {
      const container = document.getElementById(containerId);
      if (!container) return;
      const ins = document.createElement("ins");
      ins.className = "adsbygoogle";
      ins.style.display = "block"; // responsive ad style
      ins.style.width = "100%";    // fill container's width
      ins.setAttribute("data-ad-client", "ca-pub-3747901131960450");
      ins.setAttribute("data-ad-slot", adSlot);
      ins.setAttribute("data-ad-format", "auto");
      ins.setAttribute("data-full-width-responsive", "true");
      container.appendChild(ins);
      if (!ins.getAttribute("data-adsbygoogle-status")) {
        (adsbygoogle = window.adsbygoogle || []).push({});
      }
    }

    function initAdUnits() {
      // Use a delay (1000ms) to ensure containers are rendered
      setTimeout(() => {
        // Right Sidebar Ads
        insertAdSenseAd("right-ad-unit-1", "7966995632");
        insertAdSenseAd("right-ad-unit-2", "8337760213");
        // Left Sidebar Ads
        insertAdSenseAd("left-ad-unit-1", "1259785352");
        insertAdSenseAd("left-ad-unit-2", "3753316246");
      }, 1000);
    }

    window.addEventListener("load", function () {
      loadAdSenseAds(initAdUnits);
    });
  </script>

  <!-- Ad Refresh Logic: Only refresh ads (not the whole page) once every 2 minutes -->
  <script>
    let lastAdRefreshTime = Date.now();

    function refreshAds() {
      const now = Date.now();
      if (now - lastAdRefreshTime >= 120000) { // 2 minutes
        // Define the ad units with container IDs and ad slot numbers
        const adUnits = [
          { containerId: "right-ad-unit-1", adSlot: "7966995632" },
          { containerId: "right-ad-unit-2", adSlot: "8337760213" },
          { containerId: "left-ad-unit-1", adSlot: "1259785352" },
          { containerId: "left-ad-unit-2", adSlot: "3753316246" }
        ];
        adUnits.forEach(unit => {
          const container = document.getElementById(unit.containerId);
          if (container) {
            container.innerHTML = "";
            // Re-create the <ins> element for the ad
            const ins = document.createElement("ins");
            ins.className = "adsbygoogle";
            ins.style.display = "block";
            ins.style.width = "100%";
            ins.setAttribute("data-ad-client", "ca-pub-3747901131960450");
            ins.setAttribute("data-ad-slot", unit.adSlot);
            ins.setAttribute("data-ad-format", "auto");
            ins.setAttribute("data-full-width-responsive", "true");
            container.appendChild(ins);
          }
        });
        // Trigger the adsbygoogle request to load new ads
        (adsbygoogle = window.adsbygoogle || []).push({});
        lastAdRefreshTime = now;
        console.log("Ads refreshed at", new Date(now).toLocaleTimeString());
      }
    }

    // Refresh ads when the page/tab becomes visible again.
    document.addEventListener("visibilitychange", () => {
      if (document.visibilityState === "visible") {
        refreshAds();
      }
    });

    // Refresh ads when certain actions are performed on the page.
    ["startButton", "stopButton", "btnGuide", "generateNoteButton"].forEach(id => {
      const el = document.getElementById(id);
      if (el) {
        el.addEventListener("click", refreshAds);
      }
    });
  </script>

  <!-- Enforce grid container height on load, resize, and after a short delay -->
  <script>
    function setGridHeight() {
      const grid = document.querySelector(".grid-container");
      if (grid) {
        let height = window.visualViewport ? window.visualViewport.height : window.innerHeight;
        grid.style.height = height + "px";
      }
    }
    window.addEventListener("load", function () {
      setGridHeight();
      let interval = setInterval(setGridHeight, 200);
      setTimeout(() => clearInterval(interval), 2000);
    });
    window.addEventListener("resize", setGridHeight);
  </script>

  <!-- Import the main module to initialize language, recording, note generation, and UI functionalities -->
  <script type="module" src="./js/main.js"></script>
</body>
</html>
