<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title id="page-title-transcribe">Transcription Tool with Ads and Guide Overlay</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&family=Merriweather:wght@300;400&display=swap" rel="stylesheet">
  <style>
    /* Base Styles */
    body {
      font-family: 'Roboto', sans-serif;
      background-color: #f8f8f8;
      color: #333;
      margin: 0;
      padding: 0;
    }
    /* Grid Layout */
    .grid-container {
      display: grid;
      grid-template-columns: 300px 1fr 300px;
      height: 100vh; /* Always force to fill the viewport */
    }
    /* Left Sidebar */
    .sidebar {
      background-color: #e0e0e0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 20px;
      position: relative;
    }
    .sidebar button {
      font-size: 18px;
      padding: 15px;
    }
    /* Main Content */
    .main-content {
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 20px;
      overflow-y: auto;
    }
    /* New Top Bar */
    .top-bar {
      background-color: #e0e0e0; /* Same as left sidebar */
      height: 50px; /* Adjust as needed */
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
      margin-bottom: 20px; /* Space between top bar and recording area */
    }
    .top-bar button {
      font-size: 18px;
      padding: 10px 20px;
    }
    .top-bar #lang-container-transcribe {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .top-bar #lang-icon-transcribe {
      width: 36px;
      height: 36px;
      margin-right: 8px;
    }
    .top-bar #lang-select-transcribe {
      padding: 5px;
      font-size: 18px;
    }
    /* Recording Area (Top Half) */
    .recording-area {
      border-bottom: 1px solid #ddd;
      padding-bottom: 20px;
    }
    .recording-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    .timer {
      font-size: 18px;
      margin-bottom: 10px;
      color: #333;
    }
    /* Cost Overview Hyperlink */
    #openaiUsageLink {
      font-size: inherit;
      font-family: inherit;
      text-decoration: underline;
      color: blue;
      margin: 0;
    }
    #openaiUsageLink:hover {
      color: darkblue;
    }
    /* Auto-resizing Textareas */
    #transcription, #generatedNote, #customPrompt {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 10px;
      font-size: 16px;
      box-sizing: border-box;
      margin-bottom: 20px;
      font-family: 'Roboto', sans-serif;
      resize: none;
    }
    #transcription { resize: vertical; }
    #transcription, #generatedNote { min-height: 150px; }
    #customPrompt { min-height: 200px; }
    /* Button Styles */
    button {
      background-color: #5a9;
      color: #fff;
      border: none;
      border-radius: 10px;
      padding: 12px 20px;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.3s, transform 0.1s;
      margin: 10px;
    }
    button:hover { background-color: #489; }
    button:active { transform: scale(0.98); }
    button:disabled {
      background-color: #ccc;
      color: #666;
      cursor: not-allowed;
      opacity: 0.6;
      transition: none;
      transform: none;
    }
    /* Bottom Half: Two Columns */
    .bottom-half {
      display: flex;
      gap: 20px;
      flex: 1;
    }
    .column {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    /* Right Sidebar (Ad Area) */
    .ad-sidebar {
      background-color: #e0e0e0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    /* New Ad Container – removed old adsterra markup */
    #right-ad-unit-1 {
      width: 300px;
      /* Let the ad be responsive; no fixed height */
      min-height: 250px;
      background: transparent;
      margin-bottom: 0;
    }
    /* New container for the second ad */
    #right-ad-unit-2 {
      width: 300px;
      min-height: 250px;
      background: transparent;
      margin-top: 10px; /* Adjust spacing as needed */
    }
    /* Original Language Dropdown in Sidebar (if used outside top bar) */
    #lang-container-transcribe {
      position: absolute;
      bottom: 20px;
      left: 20px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    #lang-icon-transcribe { width: 36px; height: 36px; }
    #lang-select-transcribe {
      font-size: 18px;
      padding: 4px;
    }
    /* New CSS rule to hide unwanted consent element (if any remains) */
    div[style*="forced-color-adjust: initial"] {
      display: none !important;
      height: 0 !important;
      margin: 0 !important;
      padding: 0 !important;
    }
    /* Guide Overlay Styles */
    #guideView {
      display: none;
      position: fixed;
      top: 10%;
      left: 10%;
      width: 80%;
      height: 80%;
      background: white;
      border: 2px solid #ccc;
      padding: 20px;
      overflow-y: auto;
      z-index: 2000;
    }
    #guideView.active { display: block; }
  </style>
</head>
<body>
  <div class="grid-container">
    <!-- Left Sidebar (reserved for ads) -->
    <aside class="sidebar">
      <!-- Ads will be placed here -->
    </aside>
    <!-- Main Content -->
    <main class="main-content">
      <!-- New Top Bar containing Guide button (left) and Language pulldown (right) -->
      <div class="top-bar">
        <button id="btnGuide">Guide</button>
        <div id="lang-container-transcribe">
          <img src="language-icon.png" alt="Language Icon" id="lang-icon-transcribe">
          <select id="lang-select-transcribe">
            <option value="en">English</option>
            <option value="no">Norsk</option>
            <option value="sv">Svenska</option>
            <option value="de">Deutsch</option>
            <option value="fr">Français</option>
            <option value="it">Italiano</option>
          </select>
        </div>
      </div>
      <!-- Recording Area -->
      <div class="recording-area">
        <div class="recording-header">
          <h3 id="recordingAreaTitle">Recording Area</h3>
          <a id="openaiUsageLink" href="https://platform.openai.com/usage" target="_blank" rel="noopener noreferrer">Cost usage overview</a>
        </div>
        <div id="recordTimer" class="timer">Recording Timer: 0 sec</div>
        <div id="transcribeTimer" class="timer">Completion Timer: 0 sec</div>
        <textarea id="transcription" placeholder="Transcription result will appear here..."></textarea>
        <div>
          <button id="startButton">Start Recording</button>
          <button id="stopButton" disabled>Stop/Complete</button>
          <button id="pauseResumeButton" disabled>Pause Recording</button>
        </div>
        <div id="statusMessage">Welcome! Click "Start Recording" to begin.</div>
      </div>
      <!-- Note Generation & Custom Prompt -->
      <div class="bottom-half">
        <div class="column">
          <h3 id="noteGenerationTitle">Note Generation</h3>
          <button id="generateNoteButton">Generate Note</button>
          <div id="noteTimer" class="timer">Note Generation Timer: 0 sec</div>
          <textarea id="generatedNote" readonly placeholder="Generated note will appear here..."></textarea>
        </div>
        <div class="column">
          <h3 id="customPromptTitle">Custom Prompt</h3>
          <label for="promptSlot" id="promptSlotLabel">Prompt Slot:</label>
          <select id="promptSlot">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
            <option value="10">10</option>
          </select>
          <textarea id="customPrompt" placeholder="Enter custom prompt here" rows="1"></textarea>
        </div>
      </div>
    </main>
    <!-- Right Sidebar (Ad Area) -->
    <aside class="ad-sidebar">
      <!-- New Ad Container; old adsterra markup removed -->
      <div id="right-ad-unit-1"></div>
      <!-- New second ad container added -->
      <div id="right-ad-unit-2"></div>
    </aside>
  </div>
  
  <!-- Guide Overlay (moved outside the grid container) -->
  <div id="guideView">
    <h3 id="guideHeading">Guide & Instructions</h3>
    <p id="guideText"></p>
  </div>
  
  <!-- Inline script to toggle the guide overlay -->
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      const btnGuide = document.getElementById("btnGuide");
      const guideView = document.getElementById("guideView");
      if (btnGuide && guideView) {
        btnGuide.addEventListener("click", function() {
          guideView.classList.toggle("active");
        });
      }
    });
  </script>
  
  <!-- Dynamic Ad Injection Scripts for the new responsive ads -->
  <script>
    function loadAdSenseAds(callback) {
      const consent = document.cookie.indexOf("user_consent=accepted") !== -1;
      const npaParam = consent ? "" : "&npa=1";
      const adScript = document.createElement("script");
      adScript.async = true;
      adScript.src = "https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3747901131960450" + npaParam;
      adScript.crossOrigin = "anonymous";
      adScript.onload = callback;
      document.head.appendChild(adScript);
    }
  
    function insertAdSenseAd(containerId, adSlot) {
      const container = document.getElementById(containerId);
      if (!container) return;
      const ins = document.createElement("ins");
      ins.className = "adsbygoogle";
      ins.style.display = "block"; // responsive ad style
      ins.style.width = "100%"; // fill container's width
      ins.setAttribute("data-ad-client", "ca-pub-3747901131960450");
      ins.setAttribute("data-ad-slot", adSlot);
      ins.setAttribute("data-ad-format", "auto");
      ins.setAttribute("data-full-width-responsive", "true");
      container.appendChild(ins);
      if (!ins.getAttribute("data-adsbygoogle-status")) {
        (adsbygoogle = window.adsbygoogle || []).push({});
      }
    }
  
    function initAdUnits() {
      // Use a delay (1000ms) to ensure container is fully rendered and layout is computed.
      setTimeout(() => {
        insertAdSenseAd("right-ad-unit-1", "7966995632");
        insertAdSenseAd("right-ad-unit-2", "8337760213");
      }, 1000);
    }
  
    window.addEventListener("load", function() {
      loadAdSenseAds(initAdUnits);
    });
  </script>
  
  <!-- Enforce grid container height on load, resize, and after a short delay using visualViewport if available -->
  <script>
    function setGridHeight() {
      const grid = document.querySelector('.grid-container');
      if (grid) {
        let height = window.visualViewport ? window.visualViewport.height : window.innerHeight;
        grid.style.height = height + 'px';
      }
    }
    window.addEventListener('load', function() {
      setGridHeight();
      let interval = setInterval(setGridHeight, 200);
      setTimeout(() => clearInterval(interval), 2000); // Keep updating for 2 seconds
    });
    window.addEventListener('resize', setGridHeight);
  </script>
  
  <!-- Import the main module to initialize language, recording, note generation, and UI functionalities -->
  <script type="module" src="./js/main.js"></script>
</body>
</html>
